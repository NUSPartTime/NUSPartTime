extends layout

block content
  include header

  script.
    $.fn.bootstrapSwitch.defaults.onText = 'Open';
    $.fn.bootstrapSwitch.defaults.offText = 'Closed';
    $.fn.bootstrapSwitch.defaults.onColor = 'info';
    $.fn.bootstrapSwitch.defaults.size = 'small';

    $(document).ready(function() {
      $("[name='my-checkbox']").bootstrapSwitch();
      
      $('input[name="my-checkbox"]').on('switchChange.bootstrapSwitch', function(event, state) {
        var toggled_status = state ? 0 : 1;

        $.ajax({

          url: 'edit',
          type: 'post',
          data: { status: toggled_status },

          success: function(data) {
            console.log("success");
          },

          errors: function() {
            alert("ajax error");
          }
        });
      });

      $(".job-details-delete-button").on("click", function() {
        swal({
          title: "Are you sure?",
          text: "You will not be able to recover this job!",
          type: "warning",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "Yes, delete it!",
          closeOnConfirm: false 
        }, 
        function(){
          swal("Deleted!", "This job has been deleted.", "success");
        });
      });
      
      var displayMessage = $(".job-details-description").text();
      $(".job-details-description").html(displayMessage);

      var deadline = $.format.date($('.job-details-deadline-detail').text(), "MMMM dd yyyy");
      $('.job-details-deadline-detail').text(deadline);

      var applicationDeadline = $.format.date($('.job-details-applicationDeadline-detail').text(), "MMMM dd yyyy");
      $('.job-details-applicationDeadline-detail').text(applicationDeadline);

      $('.edit-input').addClass("hidden");

      $('.job-edit-btn').on('click', function() {
        $('.edit-input, .job-cancel-btn, .job-submit-btn').removeClass("hidden");
        $('.info, .job-edit-btn').addClass("hidden");
      });

      $('.job-cancel-btn').on('click', function() {
        $('.edit-input, .job-cancel-btn, .job-submit-btn').addClass("hidden");
        $('.info, .job-edit-btn').removeClass("hidden");
      });
    });
  
  if job

    div(class="job-details-container")
      div(class="job-details-header")
        ol(class="breadcrumb")
          li
            a(href="/company") My Posted Jobs
          li Job Details
      div(class="job-details-wrapper")
        div(class="row")
          div(class="col-sm-8")
            div(class="job-details")
              div(class="job-details-title")
                span=job.title
              div(class="job-details-status")
                if job.status == 0
                  input(type="checkbox" name="my-checkbox" class="job-details-status" checked)
                else 
                  input(type="checkbox" name="my-checkbox" class="job-details-status")

            
          div(class="col-sm-4")
            div(class="btn-toolbar pull-right job-details-button")
              a(href="/jobs/" + job.id + "/edit")
                button(class="btn btn-sm btn-warning btn-addon job-details-edit-button")
                  #[i(class="fa fa-pencil")] #[ Edit ]
              button(class="btn btn-sm btn-danger btn-addon job-details-delete-button")
                #[i(class="fa fa-trash")] #[ Delete ]

            
        div(class="row")
          div(class="col-sm-8")
            div(class="well job-details-misc")
              div(class="job-details-company row")
                div(class="col-sm-5")
                  i(class="fa fa-building" aria-hidden="true")
                  span(class="job-details-company-title") Company/Project
                div(class="col-sm-7")
                  span(class="job-details-company-detail")=job.Company.name

              div(class="job-details-salary margin-top row")
                div(class="col-sm-5")
                  i(class="fa fa-usd job-icon" aria-hidden="true")
                  span(class="job-details-salary-title") Salary
                div(class="col-sm-7")
                  span(class="job-details-salary-detail")=job.salary + " SGD / Hour"

              div(class="job-details-deadline margin-top row")
                div(class="col-sm-5")
                  i(class="fa fa-calendar")
                  span(class="job-details-eadline-title") Job End On
                div(class="col-sm-7")
                  span(class="job-details-deadline-detail")=job.deadline
              div(class="job-details-applicationDeadline margin-top row")
                div(class="col-sm-5")
                  i(class="fa fa-clock-o")
                  span(class="job-details-eadline-title") Application Deadline
                div(class="col-sm-7")
                  span(class="job-details-applicationDeadline-detail")=job.applicationDeadline

            div(class="job-details-description")=job.description

          div(class="col-sm-4")
            div(class="job-details-applicants margin-top")
              table(class="table table-striped")
                thead
                  tr
                    th Applicants
                tbody
                  each student in students
                    tr
                      td=student.matric
    div(class="signup-footer-info")
      p
        small(class="font-not-important") NUS Part Time all rights reserved ©️ 2016

          //- //- Job title
          //- div(class="page-header")
          //-   h1(class="info")=job.title
          //-   div(class="status-info")
          //-     if job.status == 0
          //-       h3 Status: Open
          //-       button(class="btn btn-danger") Close
          //-     else
          //-       h3 Status: Closed
          //-       button(class="btn btn-primary") Open

          //- div(class="form-group edit-input")
          //-   input(type="text", name="title", class="form-control" value=job.title)
          //-   hr

          //- //- All job details(on left hand side)
          //- div(class="row")
          //-   div(class="col-md-8")

          //-     //- Description
          //-     h3 Job Description
              
          //-     div(class="form-group edit-input")
          //-       textarea(name="description", class="form-control", rows="4")=job.description
              
          //-     div(class="info")
          //-       p
          //-       =job.description
            
          //-     //- Salary
          //-     h3 Salary

          //-     div(class="form-group edit-input")
          //-       input(type="number", name="salary", class="form-control", value=job.salary)
              
          //-     div(class="info")
          //-       p
          //-       =job.salary
              
          //-     //- Deadline
          //-     h3 Application Deadline
              
          //-     div(class="form-group edit-input")
          //-       input(type="date", name="application_deadline", class="form-control deadline-input")
              
          //-     div(class="info deadline-info")
          //-       p
          //-       =job.applicationDeadline
              
          //-     //- button groups
          //-     button(type="button" class="btn btn-warning job-edit-btn") Edit
          //-     button(type="button" class="btn btn-danger job-cancel-btn hidden") Cancel
          //-     button(type="submit" class="btn btn-primary job-submit-btn hidden") Update
            
          //-   //- For company infomation, on the right side
          //-   div(class="col-md-4")
          //-     h3 Company name
          //-     div(class="form-group edit-input")
          //-       select(name='companyId')
          //-         each val, index in companies
          //-           if index == job.companyId
          //-             option(value=index selected="selected")=val
          //-           else
          //-             option(value=index)=val
          //-     div(class="info")
          //-       p
          //-       =job.Company.name

          //- //- Applicants info
          //- div(id="applicant-content")
          //-   h1(class="page-header")= title

          //-   div(class="list-group")
          //-     each student in students
          //-       ul
          //-         //- Since students do not have name yet, use matric now
          //-         li=student.matric

